<Window x:Class="ConcentradoKPI.App.Views.PersonalVigenteWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:ConcentradoKPI.App.Views.Controls"
        xmlns:vm="clr-namespace:ConcentradoKPI.App.ViewModels"
        xmlns:models="clr-namespace:ConcentradoKPI.App.Models"
        Title="Personal vigente"
        Width="1100" Height="690"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <vm:ShellViewModel x:Key="Shell"/>
    </Window.Resources>

    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Save"
                        Executed="SaveCommand_Executed"
                        CanExecute="SaveCommand_CanExecute"/>
    </Window.CommandBindings>

    <Window.InputBindings>
        <KeyBinding Command="ApplicationCommands.Save" Modifiers="Control" Key="S"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Barra superior + NavBar -->
            <RowDefinition Height="*"/>
            <!-- Contenido scroll -->
        </Grid.RowDefinitions>

        <!-- TOP: barra + NavBar -->
        <StackPanel Grid.Row="0" Orientation="Vertical">
            <controls:TopBar Title="Personal vigente"/>
            <controls:NavBar DataContext="{StaticResource Shell}"/>
        </StackPanel>


        <!-- CONTENIDO con scroll -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="16" Orientation="Vertical">

                <!-- Formulario superior -->
                <Border Padding="12" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="6" Background="White">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.5*"/>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="1.2*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Fila 1 -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Razón Social de la Compañía Contratista:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3"
                                 Text="{Binding RazonSocial, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="8,4,0,4"/>

                        <!-- Fila 2 -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Nombre del Responsable de la Obra o Servicio:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3"
                                 Text="{Binding ResponsableObra, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="8,4,0,4"/>

                        <!-- Fila 3 -->
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Registro Patronal IMSS:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="2" Grid.Column="1"
                                 Text="{Binding RegistroIMSS, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="8,4,12,4"/>

                        <TextBlock Grid.Row="2" Grid.Column="2" Text="Fecha:" VerticalAlignment="Center"/>
                        <DatePicker Grid.Row="2" Grid.Column="3"
                                    SelectedDate="{Binding Fecha, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="8,4,0,4"/>

                        <!-- Fila 4 -->
                        <TextBlock Grid.Row="3" Grid.Column="0" Text="RFC de la Compañía:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="3" Grid.Column="1"
                                 Text="{Binding RFCCompania, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="8,4,12,4"/>

                        <TextBlock Grid.Row="3" Grid.Column="2" Text="Número de Proveedor:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="3" Grid.Column="3"
                                 Text="{Binding NumeroProveedor, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="8,4,0,4"/>

                        <!-- Fila 5 -->
                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Dirección legal:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="3"
                                 Text="{Binding DireccionLegal, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="8,4,0,4"/>
                    </Grid>
                </Border>

                <!-- Relación de personal -->
                <TextBlock Text="Relación de personal" Margin="0,16,0,6" FontWeight="SemiBold"/>

                <Border BorderBrush="#D9D9D9" BorderThickness="1" CornerRadius="4" Background="White">
                    <DataGrid ItemsSource="{Binding Personas}"
                              SelectedItem="{Binding SelectedPerson, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="False"
                              CanUserSortColumns="False"
                              HeadersVisibility="Column"
                              RowHeaderWidth="0"
                              ColumnHeaderHeight="32"
                              GridLinesVisibility="All"
                              Height="203"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              ScrollViewer.CanContentScroll="True">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="No" Binding="{Binding Numero, Mode=OneWay}" IsReadOnly="True" Width="40"/>
                            <DataGridTextColumn Header="NOMBRE" Binding="{Binding Nombre, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                            <DataGridTextColumn Header="No. de Afiliación" Binding="{Binding Afiliacion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="140"/>
                            <DataGridTextColumn Header="Puesto" Binding="{Binding Puesto, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="160"/>
                            <DataGridTextColumn Header="D" Binding="{Binding D, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="L" Binding="{Binding L, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="M" Binding="{Binding M, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="M" Binding="{Binding MM, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="J" Binding="{Binding J, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="V" Binding="{Binding V, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="S" Binding="{Binding S, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="42"/>
                            <DataGridTextColumn Header="HH Semana" Binding="{Binding HHSemana, Mode=OneWay}" IsReadOnly="True" Width="90"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- Total HH -->
                <TextBlock HorizontalAlignment="Right"
                           Margin="0,6,0,0"
                           Text="{Binding Path=TotalHH, Mode=OneWay, StringFormat='TOTAL DE HH TRABAJADAS = {0}'}"/>

                <!-- Agregar / Editar -->
                <TextBlock Text="Agregar / editar personal" Margin="0,16,0,4" FontWeight="SemiBold"/>

                <Border Padding="10" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="6" Background="White">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Etiquetas -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Nombre"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="No. de Afiliación"/>
                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Puesto"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" HorizontalAlignment="Center" Text="D" Margin="0,4,6,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="4" HorizontalAlignment="Center" Text="L" Margin="0,4,6,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="5" HorizontalAlignment="Center" Text="M" Margin="0,4,6,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="6" HorizontalAlignment="Center" Text="M" Margin="0,4,6,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="7" HorizontalAlignment="Center" Text="J" Margin="0,4,6,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="8" HorizontalAlignment="Center" Text="V" Margin="0,4,6,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="9" HorizontalAlignment="Center" Text="S" Margin="0,4,6,0"/>

                        <!-- Campos -->
                        <TextBox Grid.Row="1" Grid.Column="0" Text="{Binding NewNombre, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,8,0"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding NewAfiliacion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,8,0"/>
                        <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding NewPuesto, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,8,0"/>

                        <TextBox Grid.Row="1" Grid.Column="3" Width="36" TextAlignment="Center" Text="{Binding NewD, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>
                        <TextBox Grid.Row="1" Grid.Column="4" Width="36" TextAlignment="Center" Text="{Binding NewL, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>
                        <TextBox Grid.Row="1" Grid.Column="5" Width="36" TextAlignment="Center" Text="{Binding NewM, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>
                        <TextBox Grid.Row="1" Grid.Column="6" Width="36" TextAlignment="Center" Text="{Binding NewMM, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>
                        <TextBox Grid.Row="1" Grid.Column="7" Width="36" TextAlignment="Center" Text="{Binding NewJ, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>
                        <TextBox Grid.Row="1" Grid.Column="8" Width="36" TextAlignment="Center" Text="{Binding NewV, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>
                        <TextBox Grid.Row="1" Grid.Column="9" Width="36" TextAlignment="Center" Text="{Binding NewS, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,6,0"/>

                        <!-- Botones -->
                        <StackPanel Grid.Row="1" Grid.Column="10" Orientation="Horizontal" HorizontalAlignment="Right" Margin="12,4,0,0">
                            <Button Content="Agregar" Margin="0,0,6,0" Padding="12,4" Command="{Binding AddPersonCommand}"/>
                            <Button Content="Guardar" Margin="0,0,6,0" Padding="12,4" Command="{Binding ApplyEditCommand}"/>
                            <Button Content="Eliminar" Margin="0,0,6,0" Padding="12,4" Command="{Binding DeleteSelectedCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
